local projectOffset = 1

local projects = {}

if fs.exists("/projects") and fs.isDir("/projects") then
	for _, name in pairs(fs.list("/projects")) do
		local file = fs.combine("/projects", name)
		local env = {}
		local fn, err = loadfile(file)
		if fn then
			setfenv(fn, env)
			fn()
			--copy into project table
			projects[name] = {}
			for k, v in pairs(env) do
				projects[name][k] = v
			end
		end
	end
else
	print("Could not find project folder!")
	return
end

local sortedProjects = {}
for name in pairs(projects) do
	table.insert(sortedProjects, name)
end
table.sort(sortedProjects)

local function printCenter(text)
	text = tostring(text)
	local x, y = term.getSize()
	local xCur, yCur = term.getCursorPos()
	term.setCursorPos((x - #text) / 2 + 1, yCur)
	term.write(text)
end

local function displayProjects()
	local x, y = term.getSize()
	local function projectLine(index)
		term.setCursorPos(1, y)
		if term.isColor() then
			term.setBackgroundColor(y % 2 == 0 and colors.white or colors.lightGray)
			term.setTextColor(colors.black)
		else
			term.setBackgroundColor(colors.black)
			term.setTextColor(colors.white)
		end
		term.clearLine()
		term.write(projects[sortedProjects[index]].name)
	end
	term.setBackgroundColor(colors.black)
	term.setTextColor(colors.white)
	term.setCursorPos(1, 1)
	printCenter("Project List")
	for i = 1, math.min(#sortedPlaces, y - 2) do
		projectLine(projectOffset + i - 1)
	end
end

local function handleProjects(event)
	if event[1] == "mouse_click" then
		local x, y = term.getSize()
		if event[4] >= 3 and event[4] <= y then
			--clicked somewhere in the places list
			if event[3] == x then
				--clicked the scroll bar.
				if event[4] == 3 then
					--up
					if projectOffset > 1 then
						projectOffset = projectOffset - 1
					end
				elseif event[4] == y then
					if projectOffset + y - 3 < #places then
						projectOffset = projectOffset + 1
					end
				end
			else
				--clicked on a place!
				local index = projectOffset + event[4] - 3
				if index <= #places then
					--we have a project selected, use projects[sortedProjects[index]] to access.
				end			
			end
		end
	end
end

displayProjects()